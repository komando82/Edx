<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Hello World</title>
    <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>

    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">

        class Heading extends React.Component {
            render() {
                const title = !this.props.title ? 'Work Timer' : 'Break Timer'

                return (
                    <h1>{title.toUpperCase()}</h1>
                )
            }
        }

        class App extends React.Component {
            constructor() {
                super()

                this.workMin = 2
                this.workSec = 8

                this.breakMin = 1
                this.breakSec = 3

                this.intervalTime = 100

                this.state = {
                    workTimeMin: this.workMin,
                    workTimeSec: this.workSec,
                    breakTimeMin: this.breakMin,
                    breakTimeSec: this.breakSec,
                    isPaused: false,
                    breakTime: false,
                }
            }

            componentDidMount = () => {
                this.int = setInterval(() => this.countDown(), this.intervalTime)
            }

            componentDidUpdate = (prevProps, prevState, snapshot) => {
                if (this.state.isPaused !== prevState.isPaused) {
                    if (this.state.isPaused) {
                        clearInterval(this.int)
                    } else {
                        this.int = setInterval(() => this.countDown(), this.intervalTime)
                    }
                }
            }

            countDown() {
                let sec

                if (!this.state.breakTime) {
                    // console.log('work time countDown')
                    sec = this.state.workTimeSec - 1
                    this.setState({ workTimeSec: sec })

                    if (sec < 0) {
                        this.setState({ 
                            workTimeMin: this.state.workTimeMin - 1,
                            workTimeSec: 59
                        })
                    }

                    if (this.state.workTimeMin < 0) {
                        this.setState({ 
                            breakTime: !this.state.breakTime,
                            breakTimeMin: this.breakMin,
                            breakTimeSec: this.breakSec
                        })
                    }

                } else {
                    // console.log('break time countDown')
                    sec = this.state.breakTimeSec - 1
                    this.setState({ breakTimeSec: sec })

                    if (sec < 0) {
                        this.setState({ 
                            breakTimeMin: this.state.breakTimeMin - 1,
                            breakTimeSec: 59
                        })
                    }

                    if (this.state.breakTimeMin < 0) {
                        this.setState({ 
                            breakTime: !this.state.breakTime,
                            workTimeMin: this.workMin,
                            workTimeSec: this.workSec
                        })
                    }
                }
            }

            pauseCountDown = () => {
                if (this.state.isPaused) {
                    // console.log("start")
                    this.setState({ isPaused: false })
                } else {
                    // console.log("pause")
                    this.setState({ isPaused: true })
                }
            }

            resetCountDown = () => {
                // console.log("reset")
                this.resetCounterHelper()
            }

            timeChangeMin(e, breakTime = false) {
                // console.log('change time')
                let inpValue = parseInt(e.target.value)

                if (!breakTime) {
                    this.workMin = (inpValue >= 0) ? inpValue : 0
                } else {
                    this.breakMin = (inpValue >= 0) ? inpValue : 0 
                }

                this.resetCounterHelper()
            }

            timeChangeSec(e, breakTime = false) {
                // console.log('change time')
                let inpValue = parseInt(e.target.value)

                if (!breakTime) {
                    if (inpValue >= 0) {
                        if (inpValue >= 60) {
                            this.workSec = inpValue % 60
                            this.workMin += Math.floor(inpValue / 60)
                        } else {
                            this.workSec = inpValue
                        }
                    } else {
                        this.workSec = 0
                    }
                } else {
                    if (inpValue >= 0) {
                        if (inpValue >= 60) {
                            this.breakSec = inpValue % 60
                            this.breakMin += Math.floor(inpValue / 60)
                        } else {
                            this.breakSec = inpValue
                        }
                    } else {
                        this.breakSec = 0
                    }
                }

                this.resetCounterHelper()
            }

            resetCounterHelper = () => {
                this.setState({ 
                    isPaused: true,
                    workTimeMin: this.workMin,
                    workTimeSec: this.workSec,
                    breakTime: false 
                })
            }

            addZeroToNumberLowwerThanTen(num) {
                if (num < 10) {
                    return `0${num}`
                } else {
                    return num
                }
            }

            render() {
                return (
                    <div>
                        <Heading title={this.state.breakTime}/>

                        <button onClick={this.pauseCountDown}>{this.state.isPaused ? 'Start' : 'Pause'}</button>
                        <button onClick={this.resetCountDown}>Reset</button>

                        <div>
                            <span>{this.addZeroToNumberLowwerThanTen(!this.state.breakTime ? this.state.workTimeMin : this.state.breakTimeMin)}</span>
                            &nbsp;:&nbsp;
                            <span>{this.addZeroToNumberLowwerThanTen(!this.state.breakTime ? this.state.workTimeSec : this.state.breakTimeSec)}</span>
                        </div>

                        <div>
                            Work Time: 
                            Mins: <input type="text" value={this.workMin} onChange={(e) => this.timeChangeMin(e)} />
                            Secs: <input type="text" value={this.workSec} onChange={(e) => this.timeChangeSec(e)} />
                        </div>
                        <div>
                            Break Time: 
                            Mins: <input type="text" value={this.breakMin} onChange={(e) => this.timeChangeMin(e, true)} />
                            Secs: <input type="text" value={this.breakSec} onChange={(e) => this.timeChangeSec(e, true)} />
                        </div>
                    </div>
                )
            }
        }

        const rootElement = document.getElementById("root")
        ReactDOM.render(<App />, rootElement)

    </script>
</body>
</html>